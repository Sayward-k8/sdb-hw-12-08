# Домашнее задание к занятию «Резервное копирование баз данных»

# Задание 1. Резервное копирование
**Кейс**

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

  1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
  
  1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.
  
  1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

# Решение 1

  1.1 

  Для решения данной задачи необходим полный и дифференциальный бэкап. Например полный бэкап делается раз в сутки ( по ночам ) и дифференциальный делается в течение дня. Тогда для восстановления потребуется развернуть полный бэкап предыдущего дня и накатить поверх дифференциальный.
  
  1.2

  Для решения данной задачи необходим полный + инкрементный бэкап. Для восстановление на определенный час нужно использовать технологию восстановления на момент времени (PITR). Получается, что мы сначала также разворачиваем последний полный бэкап, а затем последовательно накатываем все инкрементные изменения
  
  1.3
  
  Конечно, это возможно, кейс из предыдущей домашки, где мы настраивали репликацию master-slave и master-master. Необходимо настроить рекликацию и автоматическое переключение, чтобы в случае отказа, он самостоятельно переключился, но это не резервное копирование.

# Задание 2. PostgreSQL

  2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).
  
  2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.

# Решение 2

  2.1 

Примеры команд

![alt text](https://github.com/Sayward-k8/sdb-hw-12-08/blob/main/img/12-08-2.png)
![alt text](https://github.com/Sayward-k8/sdb-hw-12-08/blob/main/img/12-08-2.1.png)

Команды для создания дампа базы и восстановления из него

```sql
pg_dump -U username -h localhost mydb > backup.sql
psql -U username -h localhost mydb < backup.sql
```

  2.2 

Автоматизировать этот процесс возможно с помощью cron для Linux или Планировщика задач на Windows, которые будут выполнять скрипт с установленными параметрами
  
# Задание 3. MySQL

  3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.
  
  3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.


# Решение 3

  3.1

Создаем полный бэкап и сохраняем бинарные логи (binary logs)

![alt text](https://github.com/Sayward-k8/sdb-hw-12-08/blob/main/img/12-08-3.png)

Командой ниже, мы делаем полный бэкап, --all-databases -копируем всё, --flush-logs закрываем и открываем новый бинарный лог, --source-data оставляем данные о позиции логов.
```
mysqldump --all-databases --flush-logs --source-data=2 > full_backup.sql
```

![alt text](https://github.com/Sayward-k8/sdb-hw-12-08/blob/main/img/12-08-3.1.png)
вот эти логи, это по сути и есть инкрементное копирования, так как для восстановления нужен полный бэкап, а уже затем мы с помощью этих бинарных логов сможем восстановить данные

```
mysqlbinlog gbichot2-bin.000007 gbichot2-bin.000008 | mysql

```

  3.1.*

   - Преимущества реплики это очень быстрая доступность данных, при выходе из строя мастера, реплику сделать основной машиной дело нескольких минут(секунд), в то время как восстановление данных их бэкапов займет гораздо больше времени.
   - При синхронной репликации потери данных равны нулю, при асинхронной — минимальны. В то же время, при ежедневном бэкапе можно потерять данные за целый день.
   - Также реплику можно использовать для обработки запросов на чтение, таким образом мы получаем снижения нагрузки с основного сервера.

   - Репликация не заменяет резервое копирование, потеря данных или их порча, скопируется на реплики и данные будут утеряны.
   - Бэкапы нужны для отката БД на момент до совершение ошибки и утери данных.





  
